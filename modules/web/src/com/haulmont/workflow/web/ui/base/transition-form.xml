<window
        xmlns="http://www.haulmont.com/schema/cuba/gui/window.xsd"
        class="com.haulmont.workflow.web.ui.base.TransitionForm"
        messagesPack="com.haulmont.workflow.web.ui.base"
        caption="msg://confirmationForm.title">

    <dsContext>
        <!--todo remove view with attachments-->
        <datasource id="cardDs" class="com.haulmont.workflow.core.entity.Card" view="w-attachments"/>

        <hierarchicalDatasource id="attachmentsDs" class="com.haulmont.workflow.core.entity.CardAttachment"
                                view="card-edit" hierarchyProperty="versionOf">
            <query>select a from wf$CardAttachment a where a.card.id = :ds$cardDs order by a.createTs desc</query>
        </hierarchicalDatasource>

        <datasource id="assignmentDs" class="com.haulmont.workflow.core.entity.Assignment" view="_local"/>

        <datasource id="varsDs">
            <datasourceClass>com.haulmont.workflow.web.ui.base.TransitionProcessVariablesDatasource</datasourceClass>
        </datasource>

        <hierarchicalDatasource id="cardRolesDs" class="com.haulmont.workflow.core.entity.CardRole"
                                view="transition-form">
            <query>
                <![CDATA[select cr from wf$CardRole cr
                where cr.card.id = :param$card and cr.procRole.proc.id = :param$card.proc
                order by cr.code]]>
            </query>
        </hierarchicalDatasource>
    </dsContext>

    <#assign width=400>
    <#assign labelWidth=90>
    <layout expand="tabsheet">
        <tabsheet id="tabsheet">
            <tab id="mainTab" caption="msg://mainTab">
                <vbox id="mainPane" expand="cardRolesFrame" spacing="true" margin="true">
                <hbox>
                    <label value="msg://transition" width="${labelWidth}"/>
                    <textField id="outcomeText" width="${width}"/>
                </hbox>

                <accessControl id="cardRolesFrameAccessControl"
                               data="com.haulmont.workflow.web.ui.base.TransitionFormAccessData" param="accessData">
                    <visible property="cardRolesVisible"/>
                    <iframe id="cardRolesFrame" screen="cardRolesFrame"/>
                </accessControl>

                <accessControl id="refusedOnlyControl" data="com.haulmont.workflow.web.ui.base.TransitionFormAccessData"
                               param="accessData">
                    <visible property="refusedOnlyVisible"/>
                    <checkBox id="refusedOnly" datasource="varsDs" property="refusedOnly" caption="msg://refusedOnly"/>
                </accessControl>

                <accessControl id="dueDateAccessControl"
                               data="com.haulmont.workflow.web.ui.base.TransitionFormAccessData"
                               param="accessData">
                    <visible property="dueDateVisible"/>
                    <hbox id="dueDatePane">
                        <label id="dueDateLabel" value="msg://dueDate" width="${labelWidth}"/>
                        <dateField id="dueDate" datasource="varsDs" property="dueDate" resolution="MIN"/>
                    </hbox>
                </accessControl>

                <accessControl data="com.haulmont.workflow.web.ui.base.TransitionFormAccessData" param="accessData">
                    <visible property="commentVisible"/>
                    <hbox id="commentTextPane">
                        <label value="msg://comment" width="${labelWidth}"/>
                        <textField id="commentText" width="${width}" rows="4"/>
                    </hbox>
                </accessControl>
                </vbox>
            </tab>
            <tab id="attachmentsTab" caption="msg://attachmentsTab" expand="attachmentsFrame" margin="true"
                 spacing="true">
                <iframe id="attachmentsFrame"
                        src="<#if workflow_transitionFormAttachmentsFramePath??>${workflow_transitionFormAttachmentsFramePath}<#else>/com/haulmont/workflow/web/ui/base/card-attachments-frame.xml</#if>"/>
                <label value="msg://requiredAttachmentsTypes" stylename="bold"/>
                <hbox id="requiredAttachmentsPane"/>
            </tab>
        </tabsheet>
        <vbox margin="true">
            <iframe id="windowActions" src="/com/haulmont/cuba/gui/edit-window.actions.xml"/>
        </vbox>
    </layout>
</window>
