<window
        xmlns="http://www.haulmont.com/schema/cuba/gui/window.xsd"
        class="com.haulmont.workflow.web.ui.base.attachments.AttachmentsMultiUploader"
        datasource="attachDs"
        messagesPack="com.haulmont.workflow.web.ui.base.attachments"
        caption="msg://editorCaption"
        focusComponent="multiUpload">

    <dsContext>
        <collectionDatasource id="attachDs" class="com.haulmont.workflow.core.entity.Attachment"
                              view="attachments-browse" refreshMode="NEVER"/>
        <collectionDatasource id="filesDs" class="com.haulmont.cuba.core.entity.FileDescriptor"
                              view="_local" refreshMode="NEVER"/>

        <collectionDatasource id="attachTypesDs" class="com.haulmont.workflow.core.entity.AttachmentType" view="_local">
            <query>
                select att from wf$AttachmentType att where att.deleteTs is null order by att.isDefault desc
            </query>
        </collectionDatasource>
    </dsContext>
    <#assign width = 560>
    <#assign height = 300>
    <layout expand="windowActions">
        <vbox id="vBox" margin="true" spacing="true" stylename="edit-area">
            <hbox height="30" spacing="true">
                <multiupload id="multiUpload" height="25px" width="90px" caption="msg://upload"/>
                <button id="removeAttachBtn" icon="icons/remove.png"/>
                <label value="msg://setAttachmentsType"/>
                <lookupField id="attachTypeCombo" editable="true"/>
            </hbox>

            <table id="uploadsTable" editable="true" multiselect="true"
                    width="${width}" height="${height}">
                <columns>
                    <column id="name" caption="msg://name" editable="true" width="150"
                            required="true" requiredMessage="msg://notNullNames"/>
                    <column id="file.extension" caption="msg://extension" editable="false" width="70"/>
                    <column id="file.size" caption="msg://size" editable="false" width="50"/>
                    <column id="comment" caption="msg://comment" editable="true" width="100"/>
                    <column id="attachType" caption="msg://attachType" editable="true" width="150"
                            optionsDatasource="attachTypesDs" required="true" requiredMessage="msg://notSetTypes"/>
                </columns>
                <rows datasource="attachDs"/>
            </table>
            <hbox width="${width}">
                <label align="MIDDLE_RIGHT" id="fileProgress" value=""/>
            </hbox>
        </vbox>
        <iframe id="windowActions" src="/com/haulmont/cuba/gui/edit-window.actions.xml"/>
    </layout>
</window>
