<?xml version="1.0"?>
<project name="workflow-db">
    
    <property name="project.dir" location=".."/>
    <property name="root.dir" location="${project.dir}/.."/>

    <import file="${root.dir}/build-inc-prj.xml"/>

    <property file="${root.dir}/build.properties"/>
    <property file="${project.dir}/local.build.properties"/>
    <property file="${project.dir}/build.properties"/>

    <property name="sql.dir" value="init/sql"/>

    <path id="run-cp">
        <fileset refid="jdbc-lib-fs"/>
    </path>

    <target name="run-hsqldb">
        <ant antfile="${root.dir}/cuba/db/db-build.xml" target="run-hsqldb" inheritall="false"/>
    </target>

    <target name="remove-db">
        <ant antfile="${root.dir}/cuba/db/db-build.xml" target="remove-db" inheritall="false"/>
    </target>

    <target name="create-db">
        <echo message="Workflow create-db: sql.dir=${sql.dir}"/>

        <ant antfile="${root.dir}/cuba/db/db-build.xml" target="create-db" inheritall="false">
            <property name="sql.dir" value="${sql.dir}"/>
            <property name="sql.delimiter" value="${sql.delimiter}"/>
            <property name="db.name" value="${db.name}"/>
            <property name="db.driver" value="${db.driver}"/>
            <property name="db.url" value="${db.url}"/>
            <property name="db.user" value="${db.user}"/>
            <property name="db.password" value="${db.password}"/>
        </ant>

        <sql classpathref="run-cp" src="${sql.dir}/jbpm.create-db.sql" delimiter=";"
            driver="${db.driver}"
            url="${db.url}"
            userid="${db.user}" password="${db.password}"
            autocommit="true"/>

        <sql classpathref="run-cp" src="${sql.dir}/create-db.sql" delimiter="${sql.delimiter}"
            driver="${db.driver}"
            url="${db.url}"
            userid="${db.user}" password="${db.password}"
            autocommit="true"/>

        <sql classpathref="run-cp" src="${sql.dir}/df.create-db.sql" delimiter="${sql.delimiter}"
            driver="${db.driver}"
            url="${db.url}"
            userid="${db.user}" password="${db.password}"
            autocommit="true"/>
    </target>

    <target name="recreate-db" depends="remove-db, run-hsqldb, create-db"/>

    <target name="create-sample-data">
        <sql classpathref="run-cp" src="${sql.dir}/create-sample-data.sql" delimiter="${sql.delimiter}"
            driver="${db.driver}"
            url="${db.url}"
            userid="${db.user}" password="${db.password}"
            autocommit="true"/>
    </target>

</project>